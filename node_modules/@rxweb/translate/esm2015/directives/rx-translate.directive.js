import { Injector, Directive, ViewContainerRef, TemplateRef, Input, Inject } from "@angular/core";
import { NgIfContext } from "@angular/common";
import { translateContainer } from "../core/translate-container";
import { BaseResolver } from "../resolver/base-resolver";
import { RxTranslateConfig } from "../interface/rx-translate-config";
import { ActivatedRoute } from "@angular/router";
import { RX_TRANSLATE_CONFIG } from "../core/rx-translate-config.const";
import { HttpClient } from "@angular/common/http";
import { viewRefContainer } from "../core/view-ref-container";
import { translateConfigContainer } from "../core/translate-config-container";
export class RxTranslateDirective {
    constructor(viewContainerRef, templateRef, injector, baseConfig, route, httpClient) {
        this.viewContainerRef = viewContainerRef;
        this.templateRef = templateRef;
        this.injector = injector;
        this.route = route;
        this.httpClient = httpClient;
        this.viewRef = null;
        this._context = new NgIfContext();
        let ref = this.templateRef;
        this.baseConfig = translateConfigContainer.config.forNgxTranslate ? translateConfigContainer.config : baseConfig;
        let elementName = null;
        if (ref._def) {
            elementName = ref._def.element.template.nodes[0].element.name;
            let node = ref._def.element.template.nodes[ref._def.element.template.nodes.length - 1];
            this.component = node.provider.token;
            this.config = translateContainer.get(node.provider.token);
        }
        else if (ref._declarationTContainer) {
            let tagName = ref._declarationTContainer.tagName;
            elementName = tagName.toLowerCase();
            let tView = ref._declarationTContainer.tView_ || ref._declarationTContainer.tViews;
            let node = tView.directiveRegistry.filter(t => t.selectors.filter(y => y == tagName)[0] != undefined)[0];
            if (node) {
                this.config = translateContainer.get(node.type);
                this.component = node.type;
            }
        }
        if (baseConfig.forNgxTranslate && this.component && elementName)
            translateContainer.setComponentState(elementName, this.component);
    }
    set translate(value) {
        if (this.config) {
            let baseResolver = new BaseResolver(this.baseConfig, this.httpClient);
            let languageCode = "";
            if (this.route.params && this.route.params["languageCode"] && this.baseConfig.languageCode !== this.route.params["languageCode"] && !this.config.config.language)
                languageCode = this.route.params["languageCode"];
            this.subscription = baseResolver.resolveData(this.config, languageCode).subscribe(x => {
                this.updateView(x);
            });
        }
        else
            this.updateView(true);
    }
    updateView(value) {
        if (this.viewRef) {
            this.viewContainerRef.clear();
            this.viewRef = null;
        }
        if (value)
            this.viewRef = this.viewContainerRef.createEmbeddedView(this.templateRef, this._context);
        else
            this.viewContainerRef.clear();
    }
    ngOnDestroy() {
        if (this.subscription)
            this.subscription.unsubscribe();
        viewRefContainer.destroy(this.component);
    }
}
RxTranslateDirective.decorators = [
    { type: Directive, args: [{
                selector: '[rxTranslate]'
            },] }
];
RxTranslateDirective.ctorParameters = () => [
    { type: ViewContainerRef },
    { type: TemplateRef },
    { type: Injector },
    { type: RxTranslateConfig, decorators: [{ type: Inject, args: [RX_TRANSLATE_CONFIG,] }] },
    { type: ActivatedRoute },
    { type: HttpClient }
];
RxTranslateDirective.propDecorators = {
    translate: [{ type: Input, args: ['rxTranslate',] }]
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicngtdHJhbnNsYXRlLmRpcmVjdGl2ZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3BhY2thZ2VzL3RyYW5zbGF0ZS9kaXJlY3RpdmVzL3J4LXRyYW5zbGF0ZS5kaXJlY3RpdmUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFFBQVEsRUFBRSxTQUFTLEVBQW9CLGdCQUFnQixFQUFFLFdBQVcsRUFBRSxLQUFLLEVBQWMsTUFBTSxFQUFhLE1BQU0sZUFBZSxDQUFDO0FBQzNJLE9BQU8sRUFBRSxXQUFXLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUM5QyxPQUFPLEVBQUUsa0JBQWtCLEVBQUUsTUFBTSw2QkFBNkIsQ0FBQztBQUVqRSxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0sMkJBQTJCLENBQUM7QUFDekQsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0sa0NBQWtDLENBQUM7QUFDckUsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBQ2pELE9BQU8sRUFBRSxtQkFBbUIsRUFBRSxNQUFNLG1DQUFtQyxDQUFDO0FBQ3hFLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQztBQUNsRCxPQUFPLEVBQUUsZ0JBQWdCLEVBQUUsTUFBTSw0QkFBNEIsQ0FBQztBQUU5RCxPQUFPLEVBQUUsd0JBQXdCLEVBQUUsTUFBTSxvQ0FBb0MsQ0FBQztBQUs5RSxNQUFNLE9BQU8sb0JBQW9CO0lBUTdCLFlBQW9CLGdCQUFrQyxFQUFVLFdBQTZCLEVBQVUsUUFBa0IsRUFBK0IsVUFBNkIsRUFBVSxLQUFxQixFQUFVLFVBQXNCO1FBQWhPLHFCQUFnQixHQUFoQixnQkFBZ0IsQ0FBa0I7UUFBVSxnQkFBVyxHQUFYLFdBQVcsQ0FBa0I7UUFBVSxhQUFRLEdBQVIsUUFBUSxDQUFVO1FBQXNFLFVBQUssR0FBTCxLQUFLLENBQWdCO1FBQVUsZUFBVSxHQUFWLFVBQVUsQ0FBWTtRQU41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QVksR0FBRyxZQUFZLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUUsWUFBWSxDQUFDLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxFQUFFO2dCQUNsRixJQUFJLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ3ZCLENBQUMsQ0FBQyxDQUFDO1NBQ047O1lBRUcsSUFBSSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsQ0FBQTtJQUM3QixDQUFDO0lBSU8sVUFBVSxDQUFDLEtBQWM7UUFDN0IsSUFBSSxJQUFJLENBQUMsT0FBTyxFQUFFO1lBQ2QsSUFBSSxDQUFDLGdCQUFnQixDQUFDLEtBQUssRUFBRSxDQUFDO1lBQzlCLElBQUksQ0FBQyxPQUFPLEdBQUcsSUFBSSxDQUFDO1NBQ3ZCO1FBQ0QsSUFBSSxLQUFLO1lBQ0wsSUFBSSxDQUFDLE9BQU8sR0FBRyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsa0JBQWtCLENBQUMsSUFBSSxDQUFDLFdBQVcsRUFBRSxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUM7O1lBRXpGLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxLQUFLLEVBQUUsQ0FBQztJQUN0QyxDQUFDO0lBRUQsV0FBVztRQUNQLElBQUksSUFBSSxDQUFDLFlBQVk7WUFDakIsSUFBSSxDQUFDLFlBQVksQ0FBQyxXQUFXLEVBQUUsQ0FBQztRQUNwQyxnQkFBZ0IsQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDO0lBQzdDLENBQUM7OztZQWxFSixTQUFTLFNBQUM7Z0JBQ1AsUUFBUSxFQUFFLGVBQWU7YUFDNUI7OztZQWYrQyxnQkFBZ0I7WUFBRSxXQUFXO1lBQXBFLFFBQVE7WUFLUixpQkFBaUIsdUJBbUJzRyxNQUFNLFNBQUMsbUJBQW1CO1lBbEJqSixjQUFjO1lBRWQsVUFBVTs7O3dCQXVDZCxLQUFLLFNBQUMsYUFBYSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdG9yLCBEaXJlY3RpdmUsICBFbWJlZGRlZFZpZXdSZWYsIFZpZXdDb250YWluZXJSZWYsIFRlbXBsYXRlUmVmLCBJbnB1dCwgRWxlbWVudFJlZiwgSW5qZWN0LCBPbkRlc3Ryb3kgfSBmcm9tIFwiQGFuZ3VsYXIvY29yZVwiO1xyXG5pbXBvcnQgeyBOZ0lmQ29udGV4dCB9IGZyb20gXCJAYW5ndWxhci9jb21tb25cIjtcclxuaW1wb3J0IHsgdHJhbnNsYXRlQ29udGFpbmVyIH0gZnJvbSBcIi4uL2NvcmUvdHJhbnNsYXRlLWNvbnRhaW5lclwiO1xyXG5pbXBvcnQgeyBUcmFuc2xhdGVDb250YWluZXJDb25maWcgfSBmcm9tIFwiLi4vaW50ZXJmYWNlL3RyYW5zbGF0ZS1jb250YWluZXItY29uZmlnXCI7XHJcbmltcG9ydCB7IEJhc2VSZXNvbHZlciB9IGZyb20gXCIuLi9yZXNvbHZlci9iYXNlLXJlc29sdmVyXCI7XHJcbmltcG9ydCB7IFJ4VHJhbnNsYXRlQ29uZmlnIH0gZnJvbSBcIi4uL2ludGVyZmFjZS9yeC10cmFuc2xhdGUtY29uZmlnXCI7XHJcbmltcG9ydCB7IEFjdGl2YXRlZFJvdXRlIH0gZnJvbSBcIkBhbmd1bGFyL3JvdXRlclwiO1xyXG5pbXBvcnQgeyBSWF9UUkFOU0xBVEVfQ09ORklHIH0gZnJvbSBcIi4uL2NvcmUvcngtdHJhbnNsYXRlLWNvbmZpZy5jb25zdFwiO1xyXG5pbXBvcnQgeyBIdHRwQ2xpZW50IH0gZnJvbSBcIkBhbmd1bGFyL2NvbW1vbi9odHRwXCI7XHJcbmltcG9ydCB7IHZpZXdSZWZDb250YWluZXIgfSBmcm9tIFwiLi4vY29yZS92aWV3LXJlZi1jb250YWluZXJcIjtcclxuaW1wb3J0IHsgU3Vic2NyaXB0aW9uIH0gZnJvbSBcInJ4anNcIjtcclxuaW1wb3J0IHsgdHJhbnNsYXRlQ29uZmlnQ29udGFpbmVyIH0gZnJvbSBcIi4uL2NvcmUvdHJhbnNsYXRlLWNvbmZpZy1jb250YWluZXJcIjtcclxuXHJcbkBEaXJlY3RpdmUoe1xyXG4gICAgc2VsZWN0b3I6ICdbcnhUcmFuc2xhdGVdJ1xyXG59KVxyXG5leHBvcnQgY2xhc3MgUnhUcmFuc2xhdGVEaXJlY3RpdmUgaW1wbGVtZW50cyBPbkRlc3Ryb3kge1xyXG4gICAgXHJcbiAgICBwcml2YXRlIHZpZXdSZWY6IEVtYmVkZGVkVmlld1JlZjxhbnk+IHwgbnVsbCA9IG51bGw7XHJcbiAgICBwcml2YXRlIF9jb250ZXh0OiBOZ0lmQ29udGV4dCA9IG5ldyBOZ0lmQ29udGV4dCgpO1xyXG4gICAgcHJpdmF0ZSBjb25maWc6IFRyYW5zbGF0ZUNvbnRhaW5lckNvbmZpZztcclxuICAgIHByaXZhdGUgY29tcG9uZW50OiBhbnk7XHJcbiAgICBwcml2YXRlIHN1YnNjcmlwdGlvbjogU3Vic2NyaXB0aW9uO1xyXG4gICAgcHJpdmF0ZSBiYXNlQ29uZmlnOiBhbnk7XHJcbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIHZpZXdDb250YWluZXJSZWY6IFZpZXdDb250YWluZXJSZWYsIHByaXZhdGUgdGVtcGxhdGVSZWY6IFRlbXBsYXRlUmVmPGFueT4sIHByaXZhdGUgaW5qZWN0b3I6IEluamVjdG9yLCBASW5qZWN0KFJYX1RSQU5TTEFURV9DT05GSUcpIGJhc2VDb25maWc6IFJ4VHJhbnNsYXRlQ29uZmlnLCBwcml2YXRlIHJvdXRlOiBBY3RpdmF0ZWRSb3V0ZSwgcHJpdmF0ZSBodHRwQ2xpZW50OiBIdHRwQ2xpZW50KSB7XHJcbiAgICAgICAgbGV0IHJlZjogYW55ID0gdGhpcy50ZW1wbGF0ZVJlZjtcclxuICAgICAgICB0aGlzLmJhc2VDb25maWcgPSB0cmFuc2xhdGVDb25maWdDb250YWluZXIuY29uZmlnLmZvck5neFRyYW5zbGF0ZSA/IHRyYW5zbGF0ZUNvbmZpZ0NvbnRhaW5lci5jb25maWcgOiBiYXNlQ29uZmlnO1xyXG4gICAgICAgIGxldCBlbGVtZW50TmFtZSA9IG51bGw7XHJcbiAgICAgICAgaWYgKHJlZi5fZGVmKSB7XHJcbiAgICAgICAgICAgIGVsZW1lbnROYW1lID0gcmVmLl9kZWYuZWxlbWVudC50ZW1wbGF0ZS5ub2Rlc1swXS5lbGVtZW50Lm5hbWVcclxuICAgICAgICAgICAgbGV0IG5vZGUgPSByZWYuX2RlZi5lbGVtZW50LnRlbXBsYXRlLm5vZGVzW3JlZi5fZGVmLmVsZW1lbnQudGVtcGxhdGUubm9kZXMubGVuZ3RoIC0gMV07XHJcbiAgICAgICAgICAgIHRoaXMuY29tcG9uZW50ID0gbm9kZS5wcm92aWRlci50b2tlbjtcclxuICAgICAgICAgICAgdGhpcy5jb25maWcgPSB0cmFuc2xhdGVDb250YWluZXIuZ2V0KG5vZGUucHJvdmlkZXIudG9rZW4pO1xyXG4gICAgICAgIH0gZWxzZSBpZiAocmVmLl9kZWNsYXJhdGlvblRDb250YWluZXIpIHtcclxuICAgICAgICAgICAgbGV0IHRhZ05hbWUgPSByZWYuX2RlY2xhcmF0aW9uVENvbnRhaW5lci50YWdOYW1lO1xyXG4gICAgICAgICAgICBlbGVtZW50TmFtZSA9IHRhZ05hbWUudG9Mb3dlckNhc2UoKTtcclxuICAgICAgICAgICAgbGV0IHRWaWV3ID0gcmVmLl9kZWNsYXJhdGlvblRDb250YWluZXIudFZpZXdfIHx8IHJlZi5fZGVjbGFyYXRpb25UQ29udGFpbmVyLnRWaWV3cztcclxuICAgICAgICAgICAgbGV0IG5vZGUgPSB0Vmlldy5kaXJlY3RpdmVSZWdpc3RyeS5maWx0ZXIodCA9PiB0LnNlbGVjdG9ycy5maWx0ZXIoeSA9PiB5ID09IHRhZ05hbWUpWzBdICE9IHVuZGVmaW5lZClbMF07XHJcbiAgICAgICAgICAgIGlmIChub2RlKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNvbmZpZyA9IHRyYW5zbGF0ZUNvbnRhaW5lci5nZXQobm9kZS50eXBlKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuY29tcG9uZW50ID0gbm9kZS50eXBlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChiYXNlQ29uZmlnLmZvck5neFRyYW5zbGF0ZSAmJiB0aGlzLmNvbXBvbmVudCAmJiBlbGVtZW50TmFtZSlcclxuICAgICAgICAgICAgdHJhbnNsYXRlQ29udGFpbmVyLnNldENvbXBvbmVudFN0YXRlKGVsZW1lbnROYW1lLCB0aGlzLmNvbXBvbmVudCk7XHJcbiAgICB9XHJcblxyXG4gICAgQElucHV0KCdyeFRyYW5zbGF0ZScpIHNldCB0cmFuc2xhdGUodmFsdWU6IGFueSkge1xyXG4gICAgICAgIGlmICh0aGlzLmNvbmZpZylcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGxldCBiYXNlUmVzb2x2ZXIgPSBuZXcgQmFzZVJlc29sdmVyKHRoaXMuYmFzZUNvbmZpZywgdGhpcy5odHRwQ2xpZW50KTtcclxuICAgICAgICAgICAgbGV0IGxhbmd1YWdlQ29kZSA9IFwiXCI7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLnJvdXRlLnBhcmFtcyAmJiB0aGlzLnJvdXRlLnBhcmFtc1tcImxhbmd1YWdlQ29kZVwiXSAmJiB0aGlzLmJhc2VDb25maWcubGFuZ3VhZ2VDb2RlICE9PSB0aGlzLnJvdXRlLnBhcmFtc1tcImxhbmd1YWdlQ29kZVwiXSAmJiAhdGhpcy5jb25maWcuY29uZmlnLmxhbmd1YWdlKVxyXG4gICAgICAgICAgICAgICAgbGFuZ3VhZ2VDb2RlID0gdGhpcy5yb3V0ZS5wYXJhbXNbXCJsYW5ndWFnZUNvZGVcIl07XHJcbiAgICAgICAgICAgIHRoaXMuc3Vic2NyaXB0aW9uID0gYmFzZVJlc29sdmVyLnJlc29sdmVEYXRhKHRoaXMuY29uZmlnLCBsYW5ndWFnZUNvZGUpLnN1YnNjcmliZSh4ID0+IHtcclxuICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlVmlldyh4KTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2VcclxuICAgICAgICAgICAgdGhpcy51cGRhdGVWaWV3KHRydWUpXHJcbiAgICB9XHJcblxyXG4gICAgXHJcblxyXG4gICAgcHJpdmF0ZSB1cGRhdGVWaWV3KHZhbHVlOiBib29sZWFuKSB7XHJcbiAgICAgICAgaWYgKHRoaXMudmlld1JlZikge1xyXG4gICAgICAgICAgICB0aGlzLnZpZXdDb250YWluZXJSZWYuY2xlYXIoKTtcclxuICAgICAgICAgICAgdGhpcy52aWV3UmVmID0gbnVsbDtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHZhbHVlKVxyXG4gICAgICAgICAgICB0aGlzLnZpZXdSZWYgPSB0aGlzLnZpZXdDb250YWluZXJSZWYuY3JlYXRlRW1iZWRkZWRWaWV3KHRoaXMudGVtcGxhdGVSZWYsIHRoaXMuX2NvbnRleHQpO1xyXG4gICAgICAgIGVsc2VcclxuICAgICAgICAgICAgdGhpcy52aWV3Q29udGFpbmVyUmVmLmNsZWFyKCk7XHJcbiAgICB9XHJcblxyXG4gICAgbmdPbkRlc3Ryb3koKTogdm9pZCB7XHJcbiAgICAgICAgaWYgKHRoaXMuc3Vic2NyaXB0aW9uKVxyXG4gICAgICAgICAgICB0aGlzLnN1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xyXG4gICAgICAgIHZpZXdSZWZDb250YWluZXIuZGVzdHJveSh0aGlzLmNvbXBvbmVudCk7XHJcbiAgICB9XHJcbn0iXX0=