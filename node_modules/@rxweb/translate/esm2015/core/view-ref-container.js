import { RxChangeDetectorRef } from "../service/rx-change-detector-ref";
const NG_CONTEXT = "__ngContext__";
export const viewRefContainer = new (class {
    constructor() {
        this.viewRefs = new Array();
        this.increment = 1;
    }
    create(instance) {
        var changeDetector = new RxChangeDetectorRef(instance);
        if (changeDetector.createViewRef())
            this.viewRefs.push(changeDetector);
        return instance[NG_CONTEXT] ? instance[NG_CONTEXT].rxRefMarkedId : 0;
    }
    markForCheck() {
        this.viewRefs.forEach(cd => {
            cd.markForCheck();
        });
    }
    destroy(instance) {
        if (instance[NG_CONTEXT] && instance[NG_CONTEXT].rxRefMarkedId !== undefined) {
            let indexOf = this.viewRefs.findIndex(t => t.instance[NG_CONTEXT].rxRefMarkedId == instance[NG_CONTEXT].rxRefMarkedId);
            if (indexOf != -1)
                this.viewRefs.splice(indexOf, 1);
        }
    }
})();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidmlldy1yZWYtY29udGFpbmVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vcGFja2FnZXMvdHJhbnNsYXRlL2NvcmUvdmlldy1yZWYtY29udGFpbmVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUNBLE9BQU8sRUFBRSxtQkFBbUIsRUFBRSxNQUFNLG1DQUFtQyxDQUFDO0FBQ3hFLE1BQU0sVUFBVSxHQUFXLGVBQWUsQ0FBQztBQUMzQyxNQUFNLENBQUMsTUFBTSxnQkFBZ0IsR0FLckIsSUFBSSxDQUFDO0lBQUE7UUFDTCxhQUFRLEdBQStCLElBQUksS0FBSyxFQUF1QixDQUFDO1FBQ3hFLGNBQVMsR0FBVyxDQUFDLENBQUM7SUFxQjFCLENBQUM7SUFwQkcsTUFBTSxDQUFDLFFBQWE7UUFDaEIsSUFBSSxjQUFjLEdBQUcsSUFBSSxtQkFBbUIsQ0FBQyxRQUFRLENBQUMsQ0FBQztRQUN2RCxJQUFJLGNBQWMsQ0FBQyxhQUFhLEVBQUU7WUFDOUIsSUFBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsY0FBYyxDQUFDLENBQUM7UUFDdkMsT0FBTyxRQUFRLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxVQUFVLENBQUMsQ0FBQyxhQUFhLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUN6RSxDQUFDO0lBRUQsWUFBWTtRQUNSLElBQUksQ0FBQyxRQUFRLENBQUMsT0FBTyxDQUFDLEVBQUUsQ0FBQyxFQUFFO1lBQ3ZCLEVBQUUsQ0FBQyxZQUFZLEVBQUUsQ0FBQztRQUN0QixDQUFDLENBQUMsQ0FBQTtJQUNOLENBQUM7SUFFRCxPQUFPLENBQUMsUUFBWTtRQUNoQixJQUFJLFFBQVEsQ0FBQyxVQUFVLENBQUMsSUFBSSxRQUFRLENBQUMsVUFBVSxDQUFDLENBQUMsYUFBYSxLQUFLLFNBQVMsRUFBRTtZQUMxRSxJQUFJLE9BQU8sR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxRQUFRLENBQUMsVUFBVSxDQUFDLENBQUMsYUFBYSxJQUFJLFFBQVEsQ0FBQyxVQUFVLENBQUMsQ0FBQyxhQUFhLENBQUMsQ0FBQztZQUN2SCxJQUFJLE9BQU8sSUFBSSxDQUFDLENBQUM7Z0JBQ2IsSUFBSSxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsT0FBTyxFQUFFLENBQUMsQ0FBQyxDQUFDO1NBQ3hDO0lBQ0wsQ0FBQztDQUNKLENBQUMsRUFBRSxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgVmlld1JlZiwgQ2hhbmdlRGV0ZWN0b3JSZWYgfSBmcm9tIFwiQGFuZ3VsYXIvY29yZVwiO1xyXG5pbXBvcnQgeyBSeENoYW5nZURldGVjdG9yUmVmIH0gZnJvbSBcIi4uL3NlcnZpY2UvcngtY2hhbmdlLWRldGVjdG9yLXJlZlwiO1xyXG5jb25zdCBOR19DT05URVhUOiBzdHJpbmcgPSBcIl9fbmdDb250ZXh0X19cIjtcclxuZXhwb3J0IGNvbnN0IHZpZXdSZWZDb250YWluZXI6XHJcbiAgICB7XHJcbiAgICAgICAgY3JlYXRlKGluc3RhbmNlOiBhbnkpOiBudW1iZXJcclxuICAgICAgICBtYXJrRm9yQ2hlY2soKTogdm9pZDtcclxuICAgICAgICBkZXN0cm95KG1hcmtJZDogbnVtYmVyKTogdm9pZDtcclxuICAgIH0gPSBuZXcgKGNsYXNzIHtcclxuICAgICAgICB2aWV3UmVmczogQXJyYXk8UnhDaGFuZ2VEZXRlY3RvclJlZj4gPSBuZXcgQXJyYXk8UnhDaGFuZ2VEZXRlY3RvclJlZj4oKTtcclxuICAgICAgICBpbmNyZW1lbnQ6IG51bWJlciA9IDE7XHJcbiAgICAgICAgY3JlYXRlKGluc3RhbmNlOiBhbnkpOiBudW1iZXIge1xyXG4gICAgICAgICAgICB2YXIgY2hhbmdlRGV0ZWN0b3IgPSBuZXcgUnhDaGFuZ2VEZXRlY3RvclJlZihpbnN0YW5jZSk7XHJcbiAgICAgICAgICAgIGlmIChjaGFuZ2VEZXRlY3Rvci5jcmVhdGVWaWV3UmVmKCkpXHJcbiAgICAgICAgICAgICAgICB0aGlzLnZpZXdSZWZzLnB1c2goY2hhbmdlRGV0ZWN0b3IpO1xyXG4gICAgICAgICAgICByZXR1cm4gaW5zdGFuY2VbTkdfQ09OVEVYVF0gPyBpbnN0YW5jZVtOR19DT05URVhUXS5yeFJlZk1hcmtlZElkIDogMDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIG1hcmtGb3JDaGVjaygpOiB2b2lkIHtcclxuICAgICAgICAgICAgdGhpcy52aWV3UmVmcy5mb3JFYWNoKGNkID0+IHtcclxuICAgICAgICAgICAgICAgIGNkLm1hcmtGb3JDaGVjaygpO1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZGVzdHJveShpbnN0YW5jZTphbnkpOiB2b2lkIHtcclxuICAgICAgICAgICAgaWYgKGluc3RhbmNlW05HX0NPTlRFWFRdICYmIGluc3RhbmNlW05HX0NPTlRFWFRdLnJ4UmVmTWFya2VkSWQgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgbGV0IGluZGV4T2YgPSB0aGlzLnZpZXdSZWZzLmZpbmRJbmRleCh0ID0+IHQuaW5zdGFuY2VbTkdfQ09OVEVYVF0ucnhSZWZNYXJrZWRJZCA9PSBpbnN0YW5jZVtOR19DT05URVhUXS5yeFJlZk1hcmtlZElkKTtcclxuICAgICAgICAgICAgICAgIGlmIChpbmRleE9mICE9IC0xKVxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMudmlld1JlZnMuc3BsaWNlKGluZGV4T2YsIDEpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfSkoKTsiXX0=