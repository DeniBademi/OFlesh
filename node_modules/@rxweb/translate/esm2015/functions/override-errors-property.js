import { AbstractControl } from "@angular/forms";
import { getKeyName } from "./get-key-name";
import { MultiLingualData } from "../core/multilingual-data";
import { getValue } from "./get-value";
import { translateConfigContainer } from "../core/translate-config-container";
import { isObject } from "./is-object";
import { runPipe } from "./pipe.transformer";
import { extract } from "./extract";
const NOT_IN = ["min", "max"];
export function overrideErrorsProperty(errorMessageConfig) {
    let language = translateConfigContainer.config.languageCode;
    Object.defineProperty(AbstractControl.prototype, "errors", {
        get: function () {
            if (this.originalErrors && this.originalErrors.languageCode != translateConfigContainer.config.languageCode) {
                this.cloneErrors = getTranslatedErrorMessages(errorMessageConfig, Object.assign({}, this.originalErrors), this.value);
            }
            return this.cloneErrors;
        },
        set: function (v) {
            this.originalErrors = v;
            this.cloneErrors = v;
            if (v && isObject(v))
                this.cloneErrors = getTranslatedErrorMessages(errorMessageConfig, Object.assign({}, v), this.value);
        },
        enumerable: true,
        configurable: true
    });
}
function getTranslatedErrorMessages(errorMessageConfig, errors, value) {
    let keyName = getKeyName("global");
    let data = MultiLingualData.get(keyName);
    if (data) {
        data = errorMessageConfig.path == "" ? data : getValue(errorMessageConfig.path, data);
        if (errors && isObject(errors)) {
            Object.keys(errors).forEach(key => {
                if (errors[key]) {
                    let message = '';
                    if (data[key])
                        message = getMessage(data, key);
                    if (message) {
                        Object.keys(errors[key]).forEach(t => {
                            if (Array.isArray(errors[key][t])) {
                                errors[key][t].forEach((x, i) => {
                                    message = message.replace(`{{${i}}}`, errors[key][t][i]);
                                });
                            }
                            else
                                message = message.replace(`{{${t}}}`, errors[key][t]);
                        });
                        value = value ? value : '';
                        message = message.replace(`{{value}}`, value);
                    }
                    if (!isObject(errors[key]))
                        errors[key] = {};
                    errors[key]["message"] = message;
                }
            });
            errors["languageCode"] = translateConfigContainer.config.languageCode;
        }
    }
    return errors;
}
function getMessage(data, key) {
    let text = data[key];
    if (text.indexOf('{{') !== -1) {
        let stringExtractor = extract(['{{', '}}']);
        let keys = stringExtractor(text);
        keys.forEach(key => {
            let value = runPipe(key, data, data);
            if (key == value && NOT_IN.indexOf(key) == -1) {
                value = getValue(key, data);
                if (value) {
                    text = text.replace(`{{${key}}}`, value);
                }
            }
        });
    }
    return text;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoib3ZlcnJpZGUtZXJyb3JzLXByb3BlcnR5LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vcGFja2FnZXMvdHJhbnNsYXRlL2Z1bmN0aW9ucy9vdmVycmlkZS1lcnJvcnMtcHJvcGVydHkudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLGdCQUFnQixDQUFBO0FBQ2hELE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUM1QyxPQUFPLEVBQUUsZ0JBQWdCLEVBQUUsTUFBTSwyQkFBMkIsQ0FBQztBQUM3RCxPQUFPLEVBQUUsUUFBUSxFQUFFLE1BQU0sYUFBYSxDQUFDO0FBRXZDLE9BQU8sRUFBRSx3QkFBd0IsRUFBRSxNQUFNLG9DQUFvQyxDQUFDO0FBQzlFLE9BQU8sRUFBRSxRQUFRLEVBQUUsTUFBTSxhQUFhLENBQUM7QUFDdkMsT0FBTyxFQUFFLE9BQU8sRUFBRSxNQUFNLG9CQUFvQixDQUFDO0FBQzdDLE9BQU8sRUFBRSxPQUFPLEVBQUUsTUFBTSxXQUFXLENBQUM7QUFDcEMsTUFBTSxNQUFNLEdBQWEsQ0FBQyxLQUFLLEVBQUUsS0FBSyxDQUFDLENBQUM7QUFFeEMsTUFBTSxVQUFVLHNCQUFzQixDQUFDLGtCQUFzQztJQUN6RSxJQUFJLFFBQVEsR0FBRyx3QkFBd0IsQ0FBQyxNQUFNLENBQUMsWUFBWSxDQUFDO0lBQzVELE1BQU0sQ0FBQyxjQUFjLENBQUMsZUFBZSxDQUFDLFNBQVMsRUFBRSxRQUFRLEVBQUU7UUFDdkQsR0FBRyxFQUFFO1lBQ0QsSUFBSSxJQUFJLENBQUMsY0FBYyxJQUFJLElBQUksQ0FBQyxjQUFjLENBQUMsWUFBWSxJQUFJLHdCQUF3QixDQUFDLE1BQU0sQ0FBQyxZQUFZLEVBQUU7Z0JBQ3pHLElBQUksQ0FBQyxXQUFXLEdBQUcsMEJBQTBCLENBQUMsa0JBQWtCLEVBQUUsTUFBTSxDQUFDLE1BQU0sQ0FBQyxFQUFFLEVBQUUs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QUMsQ0FBQztZQUNILE1BQU0sQ0FBQyxjQUFjLENBQUMsR0FBRyx3QkFBd0IsQ0FBQyxNQUFNLENBQUMsWUFBWSxDQUFDO1NBQ3pFO0tBQ0o7SUFDRCxPQUFPLE1BQU0sQ0FBQztBQUNsQixDQUFDO0FBRUQsU0FBUyxVQUFVLENBQUMsSUFBSSxFQUFFLEdBQUc7SUFDekIsSUFBSSxJQUFJLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO0lBQ3JCLElBQUksSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsRUFBRTtRQUMzQixJQUFJLGVBQWUsR0FBRyxPQUFPLENBQUMsQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLENBQUMsQ0FBQztRQUM1QyxJQUFJLElBQUksR0FBRyxlQUFlLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDakMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsRUFBRTtZQUNmLElBQUksS0FBSyxHQUFHLE9BQU8sQ0FBQyxHQUFHLEVBQUUsSUFBSSxFQUFFLElBQUksQ0FBQyxDQUFDO1lBQ3JDLElBQUksR0FBRyxJQUFJLEtBQUssSUFBSSxNQUFNLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxFQUFFO2dCQUMzQyxLQUFLLEdBQUcsUUFBUSxDQUFDLEdBQUcsRUFBRSxJQUFJLENBQUMsQ0FBQztnQkFDNUIsSUFBSSxLQUFLLEVBQUU7b0JBQ1AsSUFBSSxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUMsS0FBSyxHQUFHLElBQUksRUFBRSxLQUFLLENBQUMsQ0FBQztpQkFDNUM7YUFDSjtRQUNMLENBQUMsQ0FBQyxDQUFBO0tBQ0w7SUFDRCxPQUFPLElBQUksQ0FBQztBQUNoQixDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQWJzdHJhY3RDb250cm9sIH0gZnJvbSBcIkBhbmd1bGFyL2Zvcm1zXCJcclxuaW1wb3J0IHsgZ2V0S2V5TmFtZSB9IGZyb20gXCIuL2dldC1rZXktbmFtZVwiO1xyXG5pbXBvcnQgeyBNdWx0aUxpbmd1YWxEYXRhIH0gZnJvbSBcIi4uL2NvcmUvbXVsdGlsaW5ndWFsLWRhdGFcIjtcclxuaW1wb3J0IHsgZ2V0VmFsdWUgfSBmcm9tIFwiLi9nZXQtdmFsdWVcIjtcclxuaW1wb3J0IHsgRXJyb3JNZXNzYWdlQ29uZmlnIH0gZnJvbSBcIi4uL2ludGVyZmFjZS9lcnJvci1tZXNzYWdlLWNvbmZpZ1wiO1xyXG5pbXBvcnQgeyB0cmFuc2xhdGVDb25maWdDb250YWluZXIgfSBmcm9tIFwiLi4vY29yZS90cmFuc2xhdGUtY29uZmlnLWNvbnRhaW5lclwiO1xyXG5pbXBvcnQgeyBpc09iamVjdCB9IGZyb20gXCIuL2lzLW9iamVjdFwiO1xyXG5pbXBvcnQgeyBydW5QaXBlIH0gZnJvbSBcIi4vcGlwZS50cmFuc2Zvcm1lclwiO1xyXG5pbXBvcnQgeyBleHRyYWN0IH0gZnJvbSBcIi4vZXh0cmFjdFwiO1xyXG5jb25zdCBOT1RfSU46IHN0cmluZ1tdID0gW1wibWluXCIsIFwibWF4XCJdO1xyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIG92ZXJyaWRlRXJyb3JzUHJvcGVydHkoZXJyb3JNZXNzYWdlQ29uZmlnOiBFcnJvck1lc3NhZ2VDb25maWcpIHtcclxuICAgIGxldCBsYW5ndWFnZSA9IHRyYW5zbGF0ZUNvbmZpZ0NvbnRhaW5lci5jb25maWcubGFuZ3VhZ2VDb2RlO1xyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KEFic3RyYWN0Q29udHJvbC5wcm90b3R5cGUsIFwiZXJyb3JzXCIsIHtcclxuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgaWYgKHRoaXMub3JpZ2luYWxFcnJvcnMgJiYgdGhpcy5vcmlnaW5hbEVycm9ycy5sYW5ndWFnZUNvZGUgIT0gdHJhbnNsYXRlQ29uZmlnQ29udGFpbmVyLmNvbmZpZy5sYW5ndWFnZUNvZGUpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuY2xvbmVFcnJvcnMgPSBnZXRUcmFuc2xhdGVkRXJyb3JNZXNzYWdlcyhlcnJvck1lc3NhZ2VDb25maWcsIE9iamVjdC5hc3NpZ24oe30sIHRoaXMub3JpZ2luYWxFcnJvcnMpLCB0aGlzLnZhbHVlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5jbG9uZUVycm9ycztcclxuICAgICAgICB9LFxyXG4gICAgICAgIHNldDogZnVuY3Rpb24gKHYpIHtcclxuICAgICAgICAgICAgdGhpcy5vcmlnaW5hbEVycm9ycyA9IHY7XHJcbiAgICAgICAgICAgIHRoaXMuY2xvbmVFcnJvcnMgPSB2O1xyXG4gICAgICAgICAgICBpZiAodiAmJiBpc09iamVjdCh2KSlcclxuICAgICAgICAgICAgICAgIHRoaXMuY2xvbmVFcnJvcnMgPSBnZXRUcmFuc2xhdGVkRXJyb3JNZXNzYWdlcyhlcnJvck1lc3NhZ2VDb25maWcsIHsgLi4udiB9LHRoaXMudmFsdWUpO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcclxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcclxuICAgIH0pO1xyXG5cclxufVxyXG5cclxuZnVuY3Rpb24gZ2V0VHJhbnNsYXRlZEVycm9yTWVzc2FnZXMoZXJyb3JNZXNzYWdlQ29uZmlnOiBFcnJvck1lc3NhZ2VDb25maWcsIGVycm9yczogYW55LHZhbHVlOmFueSkge1xyXG4gICAgbGV0IGtleU5hbWUgPSBnZXRLZXlOYW1lKFwiZ2xvYmFsXCIpO1xyXG4gICAgbGV0IGRhdGEgPSBNdWx0aUxpbmd1YWxEYXRhLmdldChrZXlOYW1lKTtcclxuICAgIGlmIChkYXRhKSB7XHJcbiAgICAgICAgZGF0YSA9IGVycm9yTWVzc2FnZUNvbmZpZy5wYXRoID09IFwiXCIgPyBkYXRhIDogZ2V0VmFsdWUoZXJyb3JNZXNzYWdlQ29uZmlnLnBhdGgsIGRhdGEpO1xyXG4gICAgICAgIGlmIChlcnJvcnMgJiYgaXNPYmplY3QoZXJyb3JzKSkge1xyXG4gICAgICAgICAgICBPYmplY3Qua2V5cyhlcnJvcnMpLmZvckVhY2goa2V5ID0+IHtcclxuICAgICAgICAgICAgICAgIGlmIChlcnJvcnNba2V5XSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGxldCBtZXNzYWdlID0gJyc7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGFba2V5XSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZSA9IGdldE1lc3NhZ2UoZGF0YSxrZXkpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChtZXNzYWdlKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBPYmplY3Qua2V5cyhlcnJvcnNba2V5XSkuZm9yRWFjaCh0ID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KGVycm9yc1trZXldW3RdKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yc1trZXldW3RdLmZvckVhY2goKHgsIGkpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZSA9IG1lc3NhZ2UucmVwbGFjZShge3ske2l9fX1gLCBlcnJvcnNba2V5XVt0XVtpXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2VcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlID0gbWVzc2FnZS5yZXBsYWNlKGB7eyR7dH19fWAsIGVycm9yc1trZXldW3RdKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSB2YWx1ZSA/IHZhbHVlIDogJyc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2UgPSBtZXNzYWdlLnJlcGxhY2UoYHt7dmFsdWV9fWAsIHZhbHVlKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFpc09iamVjdChlcnJvcnNba2V5XSkpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yc1trZXldID0ge307XHJcbiAgICAgICAgICAgICAgICAgICAgZXJyb3JzW2tleV1bXCJtZXNzYWdlXCJdID0gbWVzc2FnZTtcclxuXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICBlcnJvcnNbXCJsYW5ndWFnZUNvZGVcIl0gPSB0cmFuc2xhdGVDb25maWdDb250YWluZXIuY29uZmlnLmxhbmd1YWdlQ29kZTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICByZXR1cm4gZXJyb3JzO1xyXG59XHJcblxyXG5mdW5jdGlvbiBnZXRNZXNzYWdlKGRhdGEsIGtleSkge1xyXG4gICAgbGV0IHRleHQgPSBkYXRhW2tleV07XHJcbiAgICBpZiAodGV4dC5pbmRleE9mKCd7eycpICE9PSAtMSkge1xyXG4gICAgICAgIGxldCBzdHJpbmdFeHRyYWN0b3IgPSBleHRyYWN0KFsne3snLCAnfX0nXSk7XHJcbiAgICAgICAgbGV0IGtleXMgPSBzdHJpbmdFeHRyYWN0b3IodGV4dCk7XHJcbiAgICAgICAga2V5cy5mb3JFYWNoKGtleSA9PiB7XHJcbiAgICAgICAgICAgIGxldCB2YWx1ZSA9IHJ1blBpcGUoa2V5LCBkYXRhLCBkYXRhKTtcclxuICAgICAgICAgICAgaWYgKGtleSA9PSB2YWx1ZSAmJiBOT1RfSU4uaW5kZXhPZihrZXkpID09IC0xKSB7XHJcbiAgICAgICAgICAgICAgICB2YWx1ZSA9IGdldFZhbHVlKGtleSwgZGF0YSk7XHJcbiAgICAgICAgICAgICAgICBpZiAodmFsdWUpIHtcclxuICAgICAgICAgICAgICAgICAgICB0ZXh0ID0gdGV4dC5yZXBsYWNlKGB7eyR7a2V5fX19YCwgdmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSlcclxuICAgIH1cclxuICAgIHJldHVybiB0ZXh0O1xyXG59Il19